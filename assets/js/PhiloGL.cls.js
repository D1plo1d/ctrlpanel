/*

 Copyright (c) 2011 Sencha Labs - Author: Nicolas Garcia Belmonte (http://philogb.github.com/)

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.

*/
(function(){this.PhiloGL=null;(function(){PhiloGL=function(x,t){function z(s,a,b){s=s.canvas;var f=new PhiloGL.Camera(g.fov,s.width/s.height,g.near,g.far,g);f.update();var m=new PhiloGL.Scene(a,f,c);k.program=a;k.canvas=s;k.scene=m;k.camera=f;a.$$family=="program"&&a.use();h&&PhiloGL.Events.create(k,l.extend(h,{bind:k}));if(d.src.length)new PhiloGL.IO.Textures(l.extend(d,{onComplete:function(){b(k)}}),k);else b(k)}var l=PhiloGL.$;t=l.merge({context:{},camera:{fov:45,near:0.1,far:500},program:{from:"defaults",
vs:"Default",fs:"Default"},scene:{},textures:{src:[]},events:{},onLoad:l.empty,onError:l.empty},t||{});var n=t.context,g=t.camera,h=t.events,d=t.textures,i=l.splat(t.program),c=t.scene;program=null;var j=PhiloGL.WebGL.getContext(x,n);PhiloGL.glConstants=j;if(!j){t.onError("The WebGL context couldn't been initialized");return null}var k=new PhiloGL.WebGL.Application({gl:j}),o={defaults:"fromDefaultShaders",ids:"fromShaderIds",sources:"fromShaderSources",uris:"fromShaderURIs"},p=i.length,u=function(){var s=
p,a={},b=false;return{onSuccess:function(f,m){a[m.id||p-s]=f;s--;if(s===0&&!b)z(j,p==1?f:a,function(r){t.onLoad(r)})},onError:function(f){s--;t.onError(f);b=true}}}();i.forEach(function(s){var a=s.from,b;s.gl=j;s.app=k;for(var f in o)if(a==f){b=PhiloGL.Program[o[f]](l.extend(u,s));break}if(b)u.onSuccess(b,s)})}})();PhiloGL.version="1.5.2";(function(){function x(z){var l=t.type(z);if(l=="object"){l={};for(var n in z)l[n]=x(z[n]);return l}else if(l=="array"){l=[];n=0;for(var g=z.length;n<g;n++)l[n]=
x(z[n]);return l}else return z}PhiloGL.$=function(z){return document.getElementById(z)};var t=PhiloGL.$;t.empty=function(){};t.time=Date.now;t.uid=function(){var z=t.time();return function(){return z++}}();t.extend=function(z,l){for(var n in l)z[n]=l[n];return z};t.type=function(){var z=Object.prototype.toString;return function(l){var n;n=z.call(l);n=n.substr(8,n.length-9).toLowerCase();if(n!="object")return n;if(l.$$family)return l.$$family;return l&&l.nodeName&&l.nodeType==1?"element":n}}();t.merge=
function(){for(var z={},l=0,n=arguments.length;l<n;l++){var g=arguments[l];if(t.type(g)=="object")for(var h in g){var d=g[h],i=z[h];z[h]=i&&t.type(d)=="object"&&t.type(i)=="object"?t.merge(i,d):x(d)}}return z};t.splat=function(){var z=Array.isArray;return function(l){return z(l)&&l||[l]}}()})();(function(){function x(l){for(var n in l)this[n]=l[n];this.buffers={};this.bufferMemo={};this.frameBuffers={};this.frameBufferMemo={};this.renderBuffers={};this.renderBufferMemo={};this.textures={};this.textureMemo=
{}}var t=PhiloGL.$,z={getContext:function(l,n){l=typeof l=="string"?t(l):l;var g;(g=l.getContext("experimental-webgl",n))||(g=l.getContext("webgl",n));if(g&&n&&n.debug){gl={};for(var h in g){var d=g[h];gl[h]=typeof d=="function"?function(i,c){return function(){console.log(i,Array.prototype.join.call(arguments),Array.prototype.slice.call(arguments));try{var j=c.apply(g,arguments)}catch(k){throw i+" "+k;}for(var o=[],p;(p=g.getError())!==g.NO_ERROR;)o.push(p);if(o.length)throw o.join();return j}}(h,
d):d}}else gl=g;if(gl)gl.get=function(i){return typeof i=="string"?gl[i]:i};return gl}};x.prototype={$$family:"application",setBuffer:function(l,n,g){var h=this.gl;if(g===false||g===null){(g=this.bufferMemo[n])&&h.bindBuffer(g.bufferType,null);var d=g&&g.attribute||n;l=l.attributes[d];l!==undefined&&h.disableVertexAttribArray(l)}else{g=t.extend(this.bufferMemo[n]||{bufferType:h.ARRAY_BUFFER,size:1,dataType:h.FLOAT,stride:0,offset:0,drawType:h.STATIC_DRAW},g||{});d=g.attribute||n;var i=g.bufferType,
c=n in this.buffers,j=c?this.buffers[n]:h.createBuffer(),k="value"in g,o=g.value,p=g.size,u=g.dataType,s=g.stride,a=g.offset,b=g.drawType;l=l.attributes[d];var f=l!==undefined;c||(this.buffers[n]=j);f&&h.enableVertexAttribArray(l);h.bindBuffer(i,j);k&&h.bufferData(i,o,b);f&&h.vertexAttribPointer(l,p,u,false,s,a);delete g.value;this.bufferMemo[n]=g;if(f)this.bufferMemo[d]=g;return this}},setBuffers:function(l,n){for(var g in n)this.setBuffer(l,g,n[g]);return this},setFrameBuffer:function(l,n){var g=
this.gl;if(typeof n!="object")g.bindFramebuffer(g.FRAMEBUFFER,n?this.frameBuffers[l]:null);else{n=t.merge(this.frameBufferMemo[l]||{width:0,height:0,bindToTexture:false,textureOptions:{attachment:g.COLOR_ATTACHMENT0},bindToRenderBuffer:false,renderBufferOptions:{attachment:g.DEPTH_ATTACHMENT}},n||{});var h=n.bindToTexture,d=n.bindToRenderBuffer,i=l in this.frameBuffers,c=i?this.frameBuffers[l]:g.createFramebuffer();g.bindFramebuffer(g.FRAMEBUFFER,c);i||(this.frameBuffers[l]=c);if(h){h=t.merge({data:{width:n.width,
height:n.height}},t.type(h)=="object"?h:{});i=l+"-texture";c=n.textureOptions;this.setTexture(i,h);g.framebufferTexture2D(g.FRAMEBUFFER,c.attachment,this.textureMemo[i].textureType,this.textures[i],0)}if(d){d=t.extend({width:n.width,height:n.height},t.type(d)=="object"?d:{});h=l+"-renderbuffer";i=n.renderBufferOptions;this.setRenderBuffer(h,d);g.framebufferRenderbuffer(g.FRAMEBUFFER,i.attachment,g.RENDERBUFFER,this.renderBuffers[h])}g.bindTexture(g.TEXTURE_2D,null);g.bindRenderbuffer(g.RENDERBUFFER,
null);g.bindFramebuffer(g.FRAMEBUFFER,null);this.frameBufferMemo[l]=n;return this}},setFrameBuffers:function(l){for(var n in l)this.setFrameBuffer(n,l[n]);return this},setRenderBuffer:function(l,n){var g=this.gl;if(typeof n!="object")g.bindRenderbuffer(g.RENDERBUFFER,n?this.renderBufferMemo[l]:null);else{n=t.extend(this.renderBufferMemo[l]||{storageType:g.DEPTH_COMPONENT16,width:0,height:0},n||{});var h=l in this.renderBuffers,d=h?this.renderBuffers[l]:g.createRenderbuffer(g.RENDERBUFFER);h||(this.renderBuffers[l]=
d);g.bindRenderbuffer(g.RENDERBUFFER,d);g.renderbufferStorage(g.RENDERBUFFER,n.storageType,n.width,n.height);this.renderBufferMemo[l]=n;return this}},setRenderBuffers:function(l){for(var n in l)this.setRenderBuffer(n,l[n]);return this},setTexture:function(l,n){var g=this.gl;if(!n||typeof n!="object"){g.activeTexture(n||g.TEXTURE0);g.bindTexture(this.textureMemo[l].textureType||g.TEXTURE_2D,this.textures[l])}else{if(n.data&&n.data.type===g.FLOAT)if(!g.getExtension("OES_texture_float"))throw"OES_texture_float is not supported";
n=t.merge(this.textureMemo[l]||{textureType:g.TEXTURE_2D,pixelStore:[{name:g.UNPACK_FLIP_Y_WEBGL,value:true},{name:g.UNPACK_ALIGNMENT,value:1}],parameters:[{name:g.TEXTURE_MAG_FILTER,value:g.NEAREST},{name:g.TEXTURE_MIN_FILTER,value:g.NEAREST},{name:g.TEXTURE_WRAP_S,value:g.CLAMP_TO_EDGE},{name:g.TEXTURE_WRAP_T,value:g.CLAMP_TO_EDGE}],data:{format:g.RGBA,value:false,type:g.UNSIGNED_BYTE,width:0,height:0,border:0}},n||{});var h="textureType"in n?n.textureType=g.get(n.textureType):g.TEXTURE_2D,d="textureTarget"in
n?n.textureTarget=g.get(n.textureTarget):h,i=h==g.TEXTURE_CUBE_MAP,c=l in this.textures,j=c?this.textures[l]:g.createTexture(),k=n.pixelStore,o=n.parameters,p=n.data,u=p.value,s=p.type,a=p.format,b=!!p.value;c||(this.textures[l]=j);g.bindTexture(h,j);c||k.forEach(function(f){f.name=typeof f.name=="string"?g.get(f.name):f.name;g.pixelStorei(f.name,f.value)});if(b)if(i)for(j=0;j<6;++j)(p.width||p.height)&&!u.width&&!u.height?g.texImage2D(d[j],0,a,p.width,p.height,p.border,a,s,u[j]):g.texImage2D(d[j],
0,a,a,s,u[j]);else(p.width||p.height)&&!u.width&&!u.height?g.texImage2D(d,0,a,p.width,p.height,p.border,a,s,u):g.texImage2D(d,0,a,a,s,u);else if(p.width||p.height)g.texImage2D(d,0,a,p.width,p.height,p.border,a,s,null);if(!c)for(j=0;j<o.length;j++){d=o[j];d.name=g.get(d.name);d.value=g.get(d.value);g.texParameteri(h,d.name,d.value);d.generateMipmap&&g.generateMipmap(h)}n.isCube=i;if(b)n.data.value=false;this.textureMemo[l]=n;return this}},setTextures:function(l){for(var n in l)this.setTexture(n,l[n]);
return this},use:function(l){this.gl.useProgram(l.program);this.usedProgram=l;return this}};z.Application=x;(function(){try{var l=document.createElement("canvas");PhiloGL.hasWebGL=function(){return!!(window.WebGLRenderingContext&&(l.getContext("webgl")||l.getContext("experimental-webgl")))}}catch(n){PhiloGL.hasWebGL=function(){return false}}PhiloGL.hasExtension=function(g){if(!PhiloGL.hasWebGL())return false;var h=document.createElement("canvas");return(h.getContext("webgl")||h.getContext("experimental-webgl")).getExtension(g)}})();
PhiloGL.WebGL=z})();(function(){function x(a){return{get:function(){return this[a]},set:function(b){this[a]=b},configurable:false,enumerable:false}}var t=Math.sqrt,z=Math.sin,l=Math.cos,n=Math.tan,g=Math.PI,h=Array.prototype.slice,d=this.Float32Array,i=function(){if(!d||!d.call)return Array;try{d.call({},10)}catch(a){return Array}return d}(),c=i!=Array,j=function(a,b,f){if(c){d.call(this,3);this[0]=a||0;this[1]=b||0;this[2]=f||0}else this.push(a||0,b||0,f||0);this.typedContainer=new d(3)};j.create=
function(){return new d(3)};j.prototype=Object.create(i.prototype,{$$family:{value:"Vec3"},x:x(0),y:x(1),z:x(2)});var k={setVec3:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a},set:function(a,b,f,m){a[0]=b;a[1]=f;a[2]=m;return a},add:function(a,b){return new j(a[0]+b[0],a[1]+b[1],a[2]+b[2])},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];return a},add2:function(a,b,f){a[0]=b[0]+f[0];a[1]=b[1]+f[1];a[2]=b[2]+f[2];return a},sub:function(a,b){return new j(a[0]-b[0],a[1]-b[1],a[2]-b[2])},$sub:function(a,
b){a[0]-=b[0];a[1]-=b[1];a[2]-=b[2];return a},sub2:function(a,b,f){a[0]=b[0]-f[0];a[1]=b[1]-f[1];a[2]=b[2]-f[2];return a},scale:function(a,b){return new j(a[0]*b,a[1]*b,a[2]*b)},$scale:function(a,b){a[0]*=b;a[1]*=b;a[2]*=b;return a},neg:function(a){return new j(-a[0],-a[1],-a[2])},$neg:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];return a},unit:function(a){var b=j.norm(a);if(b>0)return j.scale(a,1/b);return j.clone(a)},$unit:function(a){var b=j.norm(a);if(b>0)return j.$scale(a,1/b);return a},cross:function(a,
b){var f=a[0],m=a[1],r=a[2],q=b[0],v=b[1],w=b[2];return new j(m*w-r*v,r*q-f*w,f*v-m*q)},$cross:function(a,b){var f=a[0],m=a[1],r=a[2],q=b[0],v=b[1],w=b[2];a[0]=m*w-r*v;a[1]=r*q-f*w;a[2]=f*v-m*q;return a},distTo:function(a,b){var f=a[0]-b[0],m=a[1]-b[1],r=a[2]-b[2];return t(f*f+m*m+r*r)},distToSq:function(a,b){var f=a[0]-b[0],m=a[1]-b[1],r=a[2]-b[2];return f*f+m*m+r*r},norm:function(a){var b=a[0],f=a[1];a=a[2];return t(b*b+f*f+a*a)},normSq:function(a){var b=a[0],f=a[1];a=a[2];return b*b+f*f+a*a},dot:function(a,
b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},clone:function(a){return a.$$family?new j(a[0],a[1],a[2]):j.setVec3(new d(3),a)},toFloat32Array:function(a){var b=a.typedContainer;if(!b)return a;b[0]=a[0];b[1]=a[1];b[2]=a[2];return b}},o=j.prototype,p;for(p in k){j[p]=k[p];o[p]=function(a){return function(){var b=h.call(arguments);b.unshift(this);return j[a].apply(j,b)}}(p)}var u=function(a,b,f,m,r,q,v,w,y,A,C,D,B,F,I,J){i.call(this,16);this.length=16;typeof a=="number"?this.set(a,b,f,m,r,q,v,w,y,A,C,D,B,
F,I,J):this.id();this.typedContainer=new d(16)};u.create=function(){return new d(16)};u.prototype=Object.create(i.prototype,{$$family:{value:"Mat4"},n11:x(0),n12:x(4),n13:x(8),n14:x(12),n21:x(1),n22:x(5),n23:x(9),n24:x(13),n31:x(2),n32:x(6),n33:x(10),n34:x(14),n41:x(3),n42:x(7),n43:x(11),n44:x(15)});k={id:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){return a.$$family?new u(a[0],a[4],a[8],
a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]):new d(a)},set:function(a,b,f,m,r,q,v,w,y,A,C,D,B,F,I,J,G){a[0]=b;a[4]=f;a[8]=m;a[12]=r;a[1]=q;a[5]=v;a[9]=w;a[13]=y;a[2]=A;a[6]=C;a[10]=D;a[14]=B;a[3]=F;a[7]=I;a[11]=J;a[15]=G;return a},mulVec3:function(a,b){var f=j.clone(b);return u.$mulVec3(a,f)},$mulVec3:function(a,b){var f=b[0],m=b[1],r=b[2],q=1/(a[3]*f+a[7]*m+a[11]*r+a[15]);b[0]=(a[0]*f+a[4]*m+a[8]*r+a[12])*q;b[1]=(a[1]*f+a[5]*m+a[9]*r+a[13])*q;b[2]=(a[2]*f+a[6]*m+a[10]*
r+a[14])*q;return b},mulMat42:function(a,b,f){var m=b[0],r=b[1],q=b[2],v=b[3],w=b[4],y=b[5],A=b[6],C=b[7],D=b[8],B=b[9],F=b[10],I=b[11],J=b[12],G=b[13],E=b[14];b=b[15];var H=f[0],K=f[1],M=f[2],N=f[3],O=f[4],P=f[5],U=f[6],S=f[7],T=f[8],Q=f[9],R=f[10],L=f[11],V=f[12],W=f[13],X=f[14];f=f[15];a[0]=H*m+K*w+M*D+N*J;a[1]=H*r+K*y+M*B+N*G;a[2]=H*q+K*A+M*F+N*E;a[3]=H*v+K*C+M*I+N*b;a[4]=O*m+P*w+U*D+S*J;a[5]=O*r+P*y+U*B+S*G;a[6]=O*q+P*A+U*F+S*E;a[7]=O*v+P*C+U*I+S*b;a[8]=T*m+Q*w+R*D+L*J;a[9]=T*r+Q*y+R*B+L*G;a[10]=
T*q+Q*A+R*F+L*E;a[11]=T*v+Q*C+R*I+L*b;a[12]=V*m+W*w+X*D+f*J;a[13]=V*r+W*y+X*B+f*G;a[14]=V*q+W*A+X*F+f*E;a[15]=V*v+W*C+X*I+f*b;return a},mulMat4:function(a,b){var f=u.clone(a);return u.mulMat42(f,a,b)},$mulMat4:function(a,b){return u.mulMat42(a,a,b)},add:function(a,b){var f=u.clone(a);return u.$add(f,b)},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];a[3]+=b[3];a[4]+=b[4];a[5]+=b[5];a[6]+=b[6];a[7]+=b[7];a[8]+=b[8];a[9]+=b[9];a[10]+=b[10];a[11]+=b[11];a[12]+=b[12];a[13]+=b[13];a[14]+=b[14];a[15]+=
b[15];return a},transpose:function(a){a=u.clone(a);return u.$transpose(a)},$transpose:function(a){var b=a[8],f=a[12],m=a[1],r=a[9],q=a[13],v=a[2],w=a[6],y=a[14],A=a[3],C=a[7],D=a[11];a[1]=a[4];a[2]=b;a[3]=f;a[4]=m;a[6]=r;a[7]=q;a[8]=v;a[9]=w;a[11]=y;a[12]=A;a[13]=C;a[14]=D;return a},rotateAxis:function(a,b,f){a=u.clone(a);return u.$rotateAxis(a,b,f)},$rotateAxis:function(a,b,f){var m=z(b),r=l(b),q=1-r,v=f[0],w=f[1],y=f[2];f=v*v*q+r;b=v*w*q+y*m;var A=v*y*q-w*m,C=w*v*q-y*m,D=w*w*q+r,B=w*y*q+v*m,F=v*
y*q+w*m;m=w*y*q-v*m;r=y*y*q+r;q=a[0];v=a[1];w=a[2];y=a[3];var I=a[4],J=a[5],G=a[6],E=a[7],H=a[8],K=a[9],M=a[10],N=a[11];a[0]=q*f+I*b+H*A;a[1]=v*f+J*b+K*A;a[2]=w*f+G*b+M*A;a[3]=y*f+E*b+N*A;a[4]=q*C+I*D+H*B;a[5]=v*C+J*D+K*B;a[6]=w*C+G*D+M*B;a[7]=y*C+E*D+N*B;a[8]=q*F+I*m+H*r;a[9]=v*F+J*m+K*r;a[10]=w*F+G*m+M*r;a[11]=y*F+E*m+N*r;return a},rotateXYZ:function(a,b,f,m){a=u.clone(a);return u.$rotateXYZ(a,b,f,m)},$rotateXYZ:function(a,b,f,m){var r=a[0],q=a[1],v=a[2],w=a[3],y=a[4],A=a[5],C=a[6],D=a[7],B=a[8],
F=a[9],I=a[10],J=a[11],G=l(b),E=l(f),H=l(m);b=z(b);var K=z(f),M=z(m);m=E*H;f=-G*M+b*K*H;var N=b*M+G*K*H,O=E*M,P=G*H+b*K*M;H=-b*H+G*K*M;K=-K;b*=E;G*=E;a[0]=r*m+y*O+B*K;a[1]=q*m+A*O+F*K;a[2]=v*m+C*O+I*K;a[3]=w*m+D*O+J*K;a[4]=r*f+y*P+B*b;a[5]=q*f+A*P+F*b;a[6]=v*f+C*P+I*b;a[7]=w*f+D*P+J*b;a[8]=r*N+y*H+B*G;a[9]=q*N+A*H+F*G;a[10]=v*N+C*H+I*G;a[11]=w*N+D*H+J*G;return a},translate:function(a,b,f,m){a=u.clone(a);return u.$translate(a,b,f,m)},$translate:function(a,b,f,m){a[12]=a[0]*b+a[4]*f+a[8]*m+a[12];a[13]=
a[1]*b+a[5]*f+a[9]*m+a[13];a[14]=a[2]*b+a[6]*f+a[10]*m+a[14];a[15]=a[3]*b+a[7]*f+a[11]*m+a[15];return a},scale:function(a,b,f,m){a=u.clone(a);return u.$scale(a,b,f,m)},$scale:function(a,b,f,m){a[0]*=b;a[1]*=b;a[2]*=b;a[3]*=b;a[4]*=f;a[5]*=f;a[6]*=f;a[7]*=f;a[8]*=m;a[9]*=m;a[10]*=m;a[11]*=m;return a},invert:function(a){a=u.clone(a);return u.$invert(a)},$invert:function(a){var b=a[0],f=a[1],m=a[2],r=a[3],q=a[4],v=a[5],w=a[6],y=a[7],A=a[8],C=a[9],D=a[10],B=a[11],F=a[12],I=a[13],J=a[14],G=a[15],E=b*v-
f*q,H=b*w-m*q,K=b*y-r*q,M=f*w-m*v,N=f*y-r*v,O=m*y-r*w,P=A*I-C*F,U=A*J-D*F,S=A*G-B*F,T=C*J-D*I,Q=C*G-B*I,R=D*G-B*J,L=1/(E*R-H*Q+K*T+M*S-N*U+O*P);a[0]=(+v*R-w*Q+y*T)*L;a[1]=(-f*R+m*Q-r*T)*L;a[2]=(+I*O-J*N+G*M)*L;a[3]=(-C*O+D*N-B*M)*L;a[4]=(-q*R+w*S-y*U)*L;a[5]=(+b*R-m*S+r*U)*L;a[6]=(-F*O+J*K-G*H)*L;a[7]=(+A*O-D*K+B*H)*L;a[8]=(+q*Q-v*S+y*P)*L;a[9]=(-b*Q+f*S-r*P)*L;a[10]=(+F*N-I*K+G*E)*L;a[11]=(-A*N+C*K-B*E)*L;a[12]=(-q*T+v*U-w*P)*L;a[13]=(+b*T-f*U+m*P)*L;a[14]=(-F*M+I*H-J*E)*L;a[15]=(+A*M-C*H+D*E)*L;
return a},lookAt:function(a,b,f,m){f=j.sub(b,f);f.$unit();m=j.cross(m,f);m.$unit();var r=j.cross(f,m);r.$unit();return u.set(a,m[0],m[1],m[2],-m.dot(b),r[0],r[1],r[2],-r.dot(b),f[0],f[1],f[2],-f.dot(b),0,0,0,1)},frustum:function(a,b,f,m,r,q,v){var w=f-b,y=r-m,A=v-q;a[0]=q*2/w;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=q*2/y;a[6]=0;a[7]=0;a[8]=(f+b)/w;a[9]=(r+m)/y;a[10]=-(v+q)/A;a[11]=-1;a[12]=0;a[13]=0;a[14]=-(v*q*2)/A;a[15]=0;return a},perspective:function(a,b,f,m,r){b=m*n(b*g/360);var q=-b;return u.frustum(a,
q*f,b*f,q,b,m,r)},ortho:function(a,b,f,m,r,q,v){var w=f-b,y=r-m,A=v-q;a[0]=2/w;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2/y;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=-2/A;a[11]=0;a[12]=-(b+f)/w;a[13]=-(r+m)/y;a[14]=-(v+q)/A;a[15]=1;return a},toFloat32Array:function(a){var b=a.typedContainer;if(!b)return a;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b}};o=u.prototype;for(p in k){u[p]=
k[p];o[p]=function(a){return function(){var b=h.call(arguments);b.unshift(this);return u[a].apply(u,b)}}(p)}var s=function(a,b,f,m){i.call(this,4);this[0]=a||0;this[1]=b||0;this[2]=f||0;this[3]=m||0;this.typedContainer=new d(4)};s.create=function(){return new d(4)};k={setQuat:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},set:function(a,b,f,m,r){a[0]=b||0;a[1]=f||0;a[2]=m||0;a[3]=r||0;return a},clone:function(a){return a.$$family?new s(a[0],a[1],a[2],a[3]):s.setQuat(new d(4),a)},
neg:function(a){return new s(-a[0],-a[1],-a[2],-a[3])},$neg:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];a[3]=-a[3];return a},add:function(a,b){return new s(a[0]+b[0],a[1]+b[1],a[2]+b[2],a[3]+b[3])},$add:function(a,b){a[0]+=b[0];a[1]+=b[1];a[2]+=b[2];a[3]+=b[3];return a},sub:function(a,b){return new s(a[0]-b[0],a[1]-b[1],a[2]-b[2],a[3]-b[3])},$sub:function(a,b){a[0]-=b[0];a[1]-=b[1];a[2]-=b[2];a[3]-=b[3];return a},scale:function(a,b){return new s(a[0]*b,a[1]*b,a[2]*b,a[3]*b)},$scale:function(a,b){a[0]*=
b;a[1]*=b;a[2]*=b;a[3]*=b;return a},mulQuat:function(a,b){var f=a[0],m=a[1],r=a[2],q=a[3],v=b[0],w=b[1],y=b[2],A=b[3];return new s(q*v+f*A+m*y-r*w,q*w+m*A+r*v-f*y,q*y+r*A+f*w-m*v,q*A-f*v-m*w-r*y)},$mulQuat:function(a,b){var f=a[0],m=a[1],r=a[2],q=a[3],v=b[0],w=b[1],y=b[2],A=b[3];a[0]=q*v+f*A+m*y-r*w;a[1]=q*w+m*A+r*v-f*y;a[2]=q*y+r*A+f*w-m*v;a[3]=q*A-f*v-m*w-r*y;return a},divQuat:function(a,b){var f=a[0],m=a[1],r=a[2],q=a[3],v=b[0],w=b[1],y=b[2],A=b[3],C=1/(A*A+v*v+w*w+y*y);return new s((f*A-q*v-m*
y+r*w)*C,(f*y-q*w+m*A-r*v)*C,(m*v+r*A-q*y-f*w)*C,(q*A+f*v+m*w+r*y)*C)},$divQuat:function(a,b){var f=a[0],m=a[1],r=a[2],q=a[3],v=b[0],w=b[1],y=b[2],A=b[3],C=1/(A*A+v*v+w*w+y*y);a[0]=(f*A-q*v-m*y+r*w)*C;a[1]=(f*y-q*w+m*A-r*v)*C;a[2]=(m*v+r*A-q*y-f*w)*C;a[3]=(q*A+f*v+m*w+r*y)*C;return a},invert:function(a){var b=a[0],f=a[1],m=a[2];a=a[3];var r=1/(b*b+f*f+m*m+a*a);return new s(-b*r,-f*r,-m*r,a*r)},$invert:function(a){var b=a[0],f=a[1],m=a[2],r=a[3],q=1/(b*b+f*f+m*m+r*r);a[0]=-b*q;a[1]=-f*q;a[2]=-m*q;
a[3]=r*q;return a},norm:function(a){var b=a[0],f=a[1],m=a[2];a=a[3];return t(b*b+f*f+m*m+a*a)},normSq:function(a){var b=a[0],f=a[1],m=a[2];a=a[3];return b*b+f*f+m*m+a*a},unit:function(a){return s.scale(a,1/s.norm(a))},$unit:function(a){return s.$scale(a,1/s.norm(a))},conjugate:function(a){return new s(-a[0],-a[1],-a[2],a[3])},$conjugate:function(a){a[0]=-a[0];a[1]=-a[1];a[2]=-a[2];return a}};o=s.prototype={};for(p in k){s[p]=k[p];o[p]=function(a){return function(){var b=h.call(arguments);b.unshift(this);
return s[a].apply(s,b)}}(p)}j.fromQuat=function(a){return new j(a[0],a[1],a[2])};s.fromVec3=function(a,b){return new s(a[0],a[1],a[2],b||0)};s.fromMat4=function(a){var b,f,m;if(a[0]>a[5]&&a[0]>a[10]){b=0;f=1;m=2}else if(a[5]>a[0]&&a[5]>a[10]){b=1;f=2;m=0}else{b=2;f=0;m=1}var r=t(1+a[b*5]-a[f*5]-a[m*5]),q=new s;q[b]=0.5*r;q[f]=0.5*(a["n"+f+""+b]+a["n"+b+""+f])/r;q[m]=0.5*(a["n"+b+""+m]+a["n"+m+""+b])/r;q[3]=0.5*(a["n"+f+""+m]-a["n"+m+""+f])/r;return q};s.fromXRotation=function(a){return new s(z(a/
2),0,0,l(a/2))};s.fromYRotation=function(a){return new s(0,z(a/2),0,l(a/2))};s.fromZRotation=function(a){return new s(0,0,z(a/2),l(a/2))};s.fromAxisRotation=function(a,b){var f=a[0],m=a[1],r=a[2],q=1/t(f*f+m*m+r*r),v=z(b/2),w=l(b/2);return new s(v*f*q,v*m*q,v*r*q,w)};u.fromQuat=function(a){var b=a[3],f=a[0],m=a[1];a=a[2];return new u(b*b+f*f-m*m-a*a,2*f*m-2*b*a,2*f*a+2*b*m,0,2*f*m+2*b*a,b*b-f*f+m*m-a*a,2*m*a-2*b*f,0,2*f*a-2*b*m,2*m*a+2*b*f,b*b-f*f-m*m+a*a,0,0,0,0,1)};PhiloGL.Vec3=j;PhiloGL.Mat4=u;
PhiloGL.Quat=s})();(function(){function x(h){return h!==true?h:false}var t=PhiloGL.$,z=function(h){h=h.getBoundingClientRect();return{x:h.left,y:h.top,bbox:h}},l={get:function(h,d){return h||(d||window).event},getWheel:function(h){return h.wheelDelta?h.wheelDelta/120:-(h.detail||0)/3},getKey:function(h){var d=h.which||h.keyCode,i;a:{i=g.Keys;for(var c in i)if(i[c]==d){i=c;break a}i=void 0}c=d-111;if(c>0&&c<13)i="f"+c;i=i||String.fromCharCode(d).toLowerCase();return{code:d,key:i,shift:h.shiftKey,control:h.ctrlKey,
alt:h.altKey,meta:h.metaKey}},isRightClick:function(h){return h.which==3||h.button==2},getPos:function(h,d){d=d||window;h=h||d.event;var i=d.document;i=i.documentElement||i.body;if(h.touches&&h.touches.length)h=h.touches[0];return{x:h.pageX||h.clientX+i.scrollLeft,y:h.pageY||h.clientY+i.scrollTop}},stop:function(h){h.stopPropagation&&h.stopPropagation();h.cancelBubble=true;if(h.preventDefault)h.preventDefault();else h.returnValue=false}},n=function(h,d){var i=h.canvas;this.scene=h.scene;this.domElem=
i;this.pos=z(i);this.opt=this.callbacks=d;this.size={width:i.width||i.offsetWidth,height:i.height||i.offsetHeight};this.attachEvents()};n.prototype={hovered:false,pressed:false,touched:false,touchMoved:false,moved:false,attachEvents:function(){var h=this.domElem,d=this;if(this.opt.disableContextMenu)h.oncontextmenu=function(){return false};["mouseup","mousedown","mousemove","mouseover","mouseout","touchstart","touchmove","touchend"].forEach(function(c){h.addEventListener(c,function(j,k){d[c](d.eventInfo(c,
j,k))},false)});["keydown","keyup"].forEach(function(c){document.addEventListener(c,function(j,k){d[c](d.eventInfo(c,j,k))},false)});var i="";i=!document.getBoxObjectFor&&window.mozInnerScreenX==null?"mousewheel":"DOMMouseScroll";h.addEventListener(i,function(c,j){d.mousewheel(d.eventInfo("mousewheel",c,j))},false)},eventInfo:function(h,d,i){var c=this.domElem,j=this.scene,k=this.opt,o=this.getSize(),p=k.relative,u=k.centerOrigin,s=k.cachePosition&&this.pos||z(c),a=l.get(d,i),b=l.getPos(d,i);d={};
i=b.x;c=b.y;if(p){i-=s.x;c-=s.y;if(u){i-=o.width/2;c-=o.height/2;c*=-1}}switch(h){case "mousewheel":d.wheel=l.getWheel(a);break;case "keydown":case "keyup":t.extend(d,l.getKey(a));break;case "mouseup":d.isRightClick=l.isRightClick(a)}var f;t.extend(d,{x:i,y:c,cache:false,stop:function(){l.stop(a)},getTarget:function(){if(f)return f;return f=!k.picking||j.pick(b.x-s.x,b.y-s.y,k.lazyPicking)||true}});d.event=a;return d},getSize:function(){if(this.cacheSize)return this.size;var h=this.domElem;return{width:h.width||
h.offsetWidth,height:h.height||h.offsetHeight}},mouseup:function(h){if(!this.moved)if(h.isRightClick)this.callbacks.onRightClick(h,this.hovered);else this.callbacks.onClick(h,x(this.pressed));if(this.pressed){if(this.moved)this.callbacks.onDragEnd(h,x(this.pressed));else this.callbacks.onDragCancel(h,x(this.pressed));this.pressed=this.moved=false}},mouseout:function(h){for(var d=h.relatedTarget,i=this.domElem;d&&d.parentNode;){if(i==d.parentNode)return;d=d.parentNode}if(this.hovered){this.callbacks.onMouseLeave(h,
this.hovered);this.hovered=false}if(this.pressed&&this.moved){this.callbacks.onDragEnd(h);this.pressed=this.moved=false}},mouseover:function(){},mousemove:function(h){if(this.pressed){this.moved=true;this.callbacks.onDragMove(h,x(this.pressed))}else{if(this.hovered){var d=x(h.getTarget());if(!d||d.hash!=this.hash){this.callbacks.onMouseLeave(h,this.hovered);if(this.hash=this.hovered=d){this.hash=d.hash;this.callbacks.onMouseEnter(h,this.hovered)}}else this.callbacks.onMouseMove(h,this.hovered)}else if(this.hash=
this.hovered=x(h.getTarget())){this.hash=this.hovered.hash;this.callbacks.onMouseEnter(h,this.hovered)}if(!this.opt.picking)this.callbacks.onMouseMove(h)}},mousewheel:function(h){this.callbacks.onMouseWheel(h)},mousedown:function(h){this.pressed=h.getTarget();this.callbacks.onDragStart(h,x(this.pressed))},touchstart:function(h){this.touched=h.getTarget();this.callbacks.onTouchStart(h,x(this.touched))},touchmove:function(h){if(this.touched){this.touchMoved=true;this.callbacks.onTouchMove(h,x(this.touched))}},
touchend:function(h){if(this.touched){if(this.touchMoved)this.callbacks.onTouchEnd(h,x(this.touched));else this.callbacks.onTouchCancel(h,x(this.touched));this.touched=this.touchMoved=false}},keydown:function(h){this.callbacks.onKeyDown(h)},keyup:function(h){this.callbacks.onKeyUp(h)}};var g={};g.create=function(h,d){d=t.extend({cachePosition:true,cacheSize:true,relative:true,centerOrigin:true,disableContextMenu:true,bind:false,picking:false,lazyPicking:false,onClick:t.empty,onRightClick:t.empty,
onDragStart:t.empty,onDragMove:t.empty,onDragEnd:t.empty,onDragCancel:t.empty,onTouchStart:t.empty,onTouchMove:t.empty,onTouchEnd:t.empty,onTouchCancel:t.empty,onMouseMove:t.empty,onMouseEnter:t.empty,onMouseLeave:t.empty,onMouseWheel:t.empty,onKeyDown:t.empty,onKeyUp:t.empty},d||{});var i=d.bind;if(i)for(var c in d)c.match(/^on[a-zA-Z0-9]+$/)&&function(j,k){d[j]=function(){return k.apply(i,Array.prototype.slice.call(arguments))}}(c,d[c]);new n(h,d);h.events=d};g.Keys={enter:13,up:38,down:40,left:37,
right:39,esc:27,space:32,backspace:8,tab:9,"delete":46};PhiloGL.Events=g})();(function(){function x(d,i){return t.merge(i||{},d.length==3?{vs:d[0],fs:d[1],gl:d[2]}:d[0]||{})}var t=PhiloGL.$,z=function(d,i,c){var j=d.createShader(c);if(j==null)throw"Error creating the shader with shader type: "+c;d.shaderSource(j,i);d.compileShader(j);if(!d.getShaderParameter(j,d.COMPILE_STATUS)){i=d.getShaderInfoLog(j);d.deleteShader(j);throw"Error while compiling the shader "+i;}return j},l=function(d){var i=d.lastIndexOf("/");
return i=="/"?"./":d.substr(0,i+1)},n=function(d,i,c,j,k){k=k||{};var o;if(o=i.match(/#include "(.*?)"/)){var p=PhiloGL.IO.XHR,u=l(d)+o[1];k[u]&&j("Recursive include");(new p({url:u,noCache:true,onError:function(s){j("Load included file `"+u+"` failed: Code "+s)},onSuccess:function(s){k[u]=true;return n(u,s,function(a){delete k[u];i=i.replace(/#include ".*?"/,a);i=i.replace(/\sHAS_EXTENSION\s*\(\s*([A-Za-z_\-0-9]+)\s*\)/g,function(b,f){return gl.getExtension(f)?" 1 ":" 0 "});return n(u,i,c,j,k)},
j,k)}})).send();return null}else return c(i)},g=function(d,i,c){var j=gl.getUniformLocation(d,i.name);d=i.type;var k=false,o=true,p,u;if(i.size>1&&c)switch(d){case gl.FLOAT:p=gl.uniform1fv;u=Float32Array;o=false;break;case gl.INT:case gl.BOOL:case gl.SAMPLER_2D:case gl.SAMPLER_CUBE:p=gl.uniform1iv;u=Uint16Array;o=false}if(o)switch(d){case gl.FLOAT:p=gl.uniform1f;break;case gl.FLOAT_VEC2:p=gl.uniform2fv;u=c?Float32Array:new Float32Array(2);break;case gl.FLOAT_VEC3:p=gl.uniform3fv;u=c?Float32Array:
new Float32Array(3);break;case gl.FLOAT_VEC4:p=gl.uniform4fv;u=c?Float32Array:new Float32Array(4);break;case gl.INT:case gl.BOOL:case gl.SAMPLER_2D:case gl.SAMPLER_CUBE:p=gl.uniform1i;break;case gl.INT_VEC2:case gl.BOOL_VEC2:p=gl.uniform2iv;u=c?Uint16Array:new Uint16Array(2);break;case gl.INT_VEC3:case gl.BOOL_VEC3:p=gl.uniform3iv;u=c?Uint16Array:new Uint16Array(3);break;case gl.INT_VEC4:case gl.BOOL_VEC4:p=gl.uniform4iv;u=c?Uint16Array:new Uint16Array(4);break;case gl.FLOAT_MAT2:k=true;p=gl.uniformMatrix2fv;
break;case gl.FLOAT_MAT3:k=true;p=gl.uniformMatrix3fv;break;case gl.FLOAT_MAT4:k=true;p=gl.uniformMatrix4fv}if(p.bind)p=p.bind(gl);else{var s=p;p=function(){s.apply(gl,arguments)}}return c&&u?function(a){p(j,new u(a))}:k?function(a){p(j,false,a.toFloat32Array())}:u?function(a){u.set(a.toFloat32Array?a.toFloat32Array():a);p(j,u)}:function(a){p(j,a)};throw"Unknown type: "+d;},h=function(d,i,c,j){var k=c.createProgram();c.attachShader(k,z(c,d,c.VERTEX_SHADER));c.attachShader(k,z(c,i,c.FRAGMENT_SHADER));
c.linkProgram(k);if(!c.getProgramParameter(k,c.LINK_STATUS))throw"Error linking the shader: "+c.getProgramInfoLog(k);if(!k)return false;d={};i={};for(var o,p,u=c.getProgramParameter(k,c.ACTIVE_ATTRIBUTES),s=0;s<u;s++){o=c.getActiveAttrib(k,s);p=o.name;o=c.getAttribLocation(k,o.name);d[p]=o}u=c.getProgramParameter(k,c.ACTIVE_UNIFORMS);for(s=0;s<u;s++){o=c.getActiveUniform(k,s);p=o.name;p=p[p.length-1]=="]"?p.substr(0,p.length-3):p;i[p]=g(k,o,o.name!=p)}this.program=k;this.attributes=d;this.attributeEnabled=
{};this.uniforms=i;this.app=j;this.gl=c;return this};h.prototype={$$family:"program",setUniform:function(d,i){if(this.uniforms[d])this.uniforms[d](i);return this},setUniforms:function(d){for(var i in d)this.setUniform(i,d[i]);return this}};["setBuffer","setBuffers","use"].forEach(function(d){h.prototype[d]=function(){var i=this.app,c=Array.prototype.slice.call(arguments);c.unshift(this);i[d].apply(i,c);return this}});["setFrameBuffer","setFrameBuffers","setRenderBuffer","setRenderBuffers","setTexture",
"setTextures"].forEach(function(d){h.prototype[d]=function(){var i=this.app;i[d].apply(i,arguments);return this}});h.fromShaderIds=function(){var d=PhiloGL.$,i=x(arguments),c=d(i.vs),j=d(i.fs),k=i.gl,o=i.app;program=null;n(i.path,c.innerHTML,function(p){return n(i.path,j.innerHTML,function(u){i.onSuccess(program=new h(p,u,k,o),i)})});return program};h.fromShaderSources=function(){var d=x(arguments,{path:"./"});gl=d.gl;app=d.app;return n(d.path,d.vs,function(i){return n(d.path,d.fs,function(c){try{var j=
new h(i,c,gl,app);if(d.onSuccess)d.onSuccess(j,d);else return j}catch(k){if(d.onError)d.onError(k,d);else throw k;}})})};h.fromDefaultShaders=function(d){d=d||{};var i=d.fs||"Default",c=PhiloGL.Shaders;d.vs=c.Vertex[d.vs||"Default"];d.fs=c.Fragment[i];return PhiloGL.Program.fromShaderSources(d)};h.fromShaderURIs=function(d){d=t.merge({path:"",vs:"",fs:"",noCache:false,onSuccess:t.empty,onError:t.empty},d||{});var i=d.path+d.vs,c=d.path+d.fs;(new PhiloGL.IO.XHR.Group({urls:[i,c],noCache:d.noCache,
onError:function(j){d.onError(j)},onComplete:function(j){try{return n(i,j[0],function(o){return n(c,j[1],function(p){d.vs=o;d.fs=p;return h.fromShaderSources(d)},d.onError)},d.onError)}catch(k){d.onError(k,d)}}})).send()};PhiloGL.Program=h})();(function(){var x=PhiloGL.$,t={},z=function(g){this.opt=g=x.merge({url:"http://philogljs.org/",method:"GET",async:true,noCache:false,sendAsBinary:false,responseType:false,onProgress:x.empty,onSuccess:x.empty,onError:x.empty,onAbort:x.empty,onComplete:x.empty},
g||{});this.initXHR()};z.State={};["UNINITIALIZED","LOADING","LOADED","INTERACTIVE","COMPLETED"].forEach(function(g,h){z.State[g]=h});z.prototype={initXHR:function(){var g=this.req=new XMLHttpRequest,h=this;["Progress","Error","Abort","Load"].forEach(function(d){if(g.addEventListener)g.addEventListener(d.toLowerCase(),function(i){h["handle"+d](i)},false);else g["on"+d.toLowerCase()]=function(i){h["handle"+d](i)}})},send:function(g){var h=this.req,d=this.opt,i=d.async;if(d.noCache)d.url+=(d.url.indexOf("?")>=
0?"&":"?")+x.uid();h.open(d.method,d.url,i);if(d.responseType)h.responseType=d.responseType;if(i)h.onreadystatechange=function(){if(h.readyState==z.State.COMPLETED)if(h.status==200)d.onSuccess(h.responseType?h.response:h.responseText);else d.onError(h.status)};d.sendAsBinary?h.sendAsBinary(g||d.body||null):h.send(g||d.body||null);if(!i)if(h.status==200)d.onSuccess(h.responseType?h.response:h.responseText);else d.onError(h.status)},setRequestHeader:function(g,h){this.req.setRequestHeader(g,h);return this},
handleProgress:function(g){if(g.lengthComputable)this.opt.onProgress(g,Math.round(g.loaded/g.total*100));else this.opt.onProgress(g,-1)},handleError:function(g){this.opt.onError(g)},handleAbort:function(){this.opt.onAbort(e)},handleLoad:function(g){this.opt.onComplete(g)}};z.Group=function(g){function h(k){return function(o){--c;g.onError(o,k);if(!c)g.onComplete(j)}}function d(k){return function(o){--c;j[k]=o;g.onSuccess(o,k);if(!c)g.onComplete(j)}}g=x.merge({urls:[],onError:x.empty,onSuccess:x.empty,
onComplete:x.empty,method:"GET",async:true,noCache:false,sendAsBinary:false,responseType:false},g||{});var i=x.splat(g.urls),c=i.length,j=Array(c);this.reqs=i.map(function(k,o){return new z({url:k,method:g.method,async:g.async,noCache:g.noCache,sendAsBinary:g.sendAsBinary,responseType:g.responseType,body:g.body,onError:h(o),onSuccess:d(o)})})};z.Group.prototype={send:function(){for(var g=0,h=this.reqs,d=h.length;g<d;++g)h[g].send()}};var l=function(g){g=x.merge({url:"http://philogljs.org/",data:{},
noCache:false,onComplete:x.empty,callbackKey:"callback"},g||{});var h=l.counter++,d=[],i;for(i in g.data)d.push(i+"="+g.data[i]);d=d.join("&");if(g.noCache)d+=(d.indexOf("?")>=0?"&":"?")+x.uid();d=g.url+(g.url.indexOf("?")>-1?"&":"?")+g.callbackKey+"=PhiloGL.IO.JSONP.requests.request_"+h+(d.length>0?"&"+d:"");var c=document.createElement("script");c.type="text/javascript";c.src=d;l.requests["request_"+h]=function(j){g.onComplete(j);c.parentNode&&c.parentNode.removeChild(c);c.clearAttributes&&c.clearAttributes()};
document.getElementsByTagName("head")[0].appendChild(c)};l.counter=0;l.requests={};var n=function(g){g=x.merge({src:[],noCache:false,onProgress:x.empty,onComplete:x.empty},g||{});var h=0,d=g.src.length,i=function(){g.onProgress(Math.round(++h/d*100));if(h==d)g.onComplete(o)},c=function(){if(++h==d)g.onComplete(o)},j=g.noCache,k=x.uid(),o=g.src.map(function(p,u){var s=new Image;s.index=u;s.onload=i;s.onerror=c;s.src=p+(j?(p.indexOf("?")>=0?"&":"?")+k:"");return s});return o};t.XHR=z;t.JSONP=l;t.Images=
n;t.Textures=function(g,h){g=x.merge({src:[],noCache:false,onComplete:x.empty},g||{});n({src:g.src,noCache:g.noCache,onComplete:function(d){var i={};d.forEach(function(c,j){i[g.id&&g.id[j]||g.src&&g.src[j]]=x.merge({data:{value:c}},g)});h.setTextures(i);g.onComplete()}})};PhiloGL.IO=t})();(function(){var x=PhiloGL.Vec3,t=PhiloGL.Mat4,z=function(l,n,g,h,d){d=d||{};var i=d.position,c=d.target,j=d.up;this.type=d.type?d.type:"perspective";this.fov=l;this.near=g;this.far=h;this.aspect=n;this.position=
i&&new x(i.x,i.y,i.z)||new x;this.target=c&&new x(c.x,c.y,c.z)||new x;this.up=j&&new x(j.x,j.y,j.z)||new x(0,1,0);if(this.type=="perspective")this.projection=(new t).perspective(l,n,g,h);else{l=g*Math.tan(l*Math.PI/360);d=-l;this.projection=(new t).ortho(d*n,l*n,d,l,g,h)}this.view=new t};z.prototype={update:function(){if(this.type=="perspective")this.projection=(new t).perspective(this.fov,this.aspect,this.near,this.far);else{var l=this.near*Math.tan(this.fov*Math.PI/360),n=-l,g=n*this.aspect,h=l*
this.aspect;this.projection=(new t).ortho(g,h,n,l,this.near,this.far)}this.view.lookAt(this.position,this.target,this.up)},setStatus:function(l){var n=this.position,g=this.view,h=this.projection,d=g.mulMat4(h),i=d.invert();l.setUniforms({cameraPosition:[n.x,n.y,n.z],projectionMatrix:h,viewMatrix:g,viewProjectionMatrix:d,viewInverseMatrix:g.invert(),viewProjectionInverseMatrix:i})}};PhiloGL.Camera=z})();(function(){function x(c,j){if(c&&c.length<j){for(var k=c[0],o=c[1],p=c[2],u=c[3],s=[k,o,p,u],a=
j/c.length,b;--a;){b=a*4;s[b]=k;s[b+1]=o;s[b+2]=p;s[b+3]=u}return new Float32Array(s)}else return c}var t=PhiloGL.$,z=PhiloGL.Vec3,l=PhiloGL.Mat4,n=Math.cos,g=Math.sin,h=Math.PI,d=Array.prototype.slice,i={attributeMap:{position:"vertices",normal:"normals",pickingColor:"pickingColors",colors:"color"}};i.Model=function(c){c=c||{};this.id=c.id||t.uid();this.pickable=!!c.pickable;this.pick=c.pick||function(){return false};this.vertices=c.vertices;this.normals=c.normals;this.textures=c.textures&&t.splat(c.textures);
this.colors=c.colors;this.indices=c.indices;this.shininess=c.shininess||0;this.reflection=c.reflection||0;this.refraction=c.refraction||0;if(c.pickingColors)this.pickingColors=c.pickingColors;if(c.texCoords)this.texCoords=c.texCoords;this.uniforms=c.uniforms||{};this.attributes=c.attributes||{};this.render=c.render;this.drawType=c.drawType||"TRIANGLES";this.display="display"in c?c.display:true;this.onBeforeRender=c.onBeforeRender||t.empty;this.onAfterRender=c.onAfterRender||t.empty;if(c.program)this.program=
c.program;this.position=new z;this.rotation=new z;this.scale=new z(1,1,1);this.matrix=new l;c.computeCentroids&&this.computeCentroids();c.computeNormals&&this.computeNormals()};i.Model.prototype=Object.create(null,{hash:{get:function(){return this.id+" "+this.$pickingIndex}},vertices:{set:function(c){if(c){var j=c.length;if(c.BYTES_PER_ELEMENT)this.$vertices=c;else if(this.$verticesLength==j)this.$vertices.set(c);else this.$vertices=new Float32Array(c);this.$verticesLength=j}else{delete this.$vertices;
delete this.$verticesLength}},get:function(){return this.$vertices}},normals:{set:function(c){if(c){var j=c.length;if(c.BYTES_PER_ELEMENT)this.$normals=c;else if(this.$normalsLength==j)this.$normals.set(c);else this.$normals=new Float32Array(c);this.$normalsLength=j}else{delete this.$normals;delete this.$normalsLength}},get:function(){return this.$normals}},colors:{set:function(c){if(c){var j=c.length;if(c.BYTES_PER_ELEMENT)this.$colors=c;else if(this.$colorsLength==j)this.$colors.set(c);else this.$colors=
new Float32Array(c);if(this.$vertices&&this.$verticesLength/3*4!=j)this.$colors=x(d.call(this.$colors),this.$verticesLength/3*4);this.$colorsLength=this.$colors.length}else{delete this.$colors;delete this.$colorsLength}},get:function(){return this.$colors}},pickingColors:{set:function(c){if(c){var j=c.length;if(c.BYTES_PER_ELEMENT)this.$pickingColors=c;else if(this.$pickingColorsLength==j)this.$pickingColors.set(c);else this.$pickingColors=new Float32Array(c);if(this.$vertices&&this.$verticesLength/
3*4!=j)this.$pickingColors=x(d.call(this.$pickingColors),this.$verticesLength/3*4);this.$pickingColorsLength=this.$pickingColors.length}else{delete this.$pickingColors;delete this.$pickingColorsLength}},get:function(){return this.$pickingColors}},texCoords:{set:function(c){if(c)if(t.type(c)=="object"){var j={},k;for(k in c){var o=c[k];j[k]=o.BYTES_PER_ELEMENT?o:new Float32Array(o)}this.$texCoords=j}else{j=c.length;if(c.BYTES_PER_ELEMENT)this.$texCoords=c;else if(this.$texCoordsLength==j)this.$texCoords.set(c);
else this.$texCoords=new Float32Array(c);this.$texCoordsLength=j}else{delete this.$texCoords;delete this.$texCoordsLength}},get:function(){return this.$texCoords}},indices:{set:function(c){if(c){var j=c.length;if(c.BYTES_PER_ELEMENT)this.$indices=c;else if(this.$indicesLength==j)this.$indices.set(c);else this.$indices=new Uint16Array(c);this.$indicesLength=j}else{delete this.$indices;delete this.$indicesLength}},get:function(){return this.$indices}}});t.extend(i.Model.prototype,{$$family:"model",
update:function(){var c=this.matrix,j=this.position,k=this.rotation,o=this.scale;c.id();c.$translate(j.x,j.y,j.z);c.$rotateXYZ(k.x,k.y,k.z);c.$scale(o.x,o.y,o.z)},computeCentroids:function(){var c=this.vertices,j=[];this.faces.forEach(function(k){var o=[0,0,0],p=0;k.forEach(function(u){u=c[u];o[0]+=u[0];o[1]+=u[1];o[2]+=u[2];p++});o[0]/=p;o[1]/=p;o[2]/=p;j.push(o)});this.centroids=j},computeNormals:function(){var c=this.vertices,j=[];this.faces.forEach(function(k){var o=c[k[0]],p=c[k[1]];k=c[k[2]];
o={x:o[0]-p[0],y:o[1]-p[1],z:o[2]-p[2]};z.$cross(o,{x:k[0]-p[0],y:k[1]-p[1],z:k[1]-p[2]});z.norm(o)>1.0E-6&&z.unit(o);j.push([o.x,o.y,o.z])});this.normals=j}});t.extend(i.Model.prototype,{setUniforms:function(c){c.setUniforms(this.uniforms)},setAttributes:function(c){var j=this.attributes,k;for(k in j){var o=j[k],p=this.id+"-"+k;if(Object.keys(o).length){o.attribute=k;c.setBuffer(p,o);delete o.value}else c.setBuffer(p,true)}},setVertices:function(c){if(this.$vertices)this.dynamic?c.setBuffer("position-"+
this.id,{attribute:"position",value:this.$vertices,size:3}):c.setBuffer("position-"+this.id)},setNormals:function(c){if(this.$normals)this.dynamic?c.setBuffer("normal-"+this.id,{attribute:"normal",value:this.$normals,size:3}):c.setBuffer("normal-"+this.id)},setIndices:function(c){var j=PhiloGL.glConstants;if(this.$indices)this.dynamic?c.setBuffer("indices-"+this.id,{bufferType:j.ELEMENT_ARRAY_BUFFER,drawType:j.STATIC_DRAW,value:this.$indices,size:1}):c.setBuffer("indices-"+this.id)},setPickingColors:function(c){if(this.$pickingColors)this.dynamic?
c.setBuffer("pickingColor-"+this.id,{attribute:"pickingColor",value:this.$pickingColors,size:4}):c.setBuffer("pickingColor-"+this.id)},setColors:function(c){if(this.$colors)this.dynamic?c.setBuffer("color-"+this.id,{attribute:"color",value:this.$colors,size:4}):c.setBuffer("color-"+this.id)},setTexCoords:function(c){if(this.$texCoords){var j=this.id,k,o,p,u;if(this.dynamic)if(t.type(this.$texCoords)=="object"){k=0;o=this.textures;for(p=o.length;k<p;k++){u=o[k];c.setBuffer("texCoord-"+k+"-"+j,{attribute:"texCoord"+
(k+1),value:this.$texCoords[u],size:2})}}else c.setBuffer("texCoord-"+j,{attribute:"texCoord1",value:this.$texCoords,size:2});else if(t.type(this.$texCoords)=="object"){k=0;o=this.textures;for(p=o.length;k<p;k++)c.setBuffer("texCoord-"+k+"-"+j)}else c.setBuffer("texCoord-"+j)}},setTextures:function(c){var j=c.app;glc=PhiloGL.glConstants;this.textures=this.textures?t.splat(this.textures):[];for(var k=0,o=this.textures,p=o.length,u=PhiloGL.Scene.MAX_TEXTURES;k<u;k++){if(k<p)if(j.textureMemo[o[k]].isCube){c.setUniform("hasTextureCube"+
(k+1),true);c.setTexture(o[k],glc["TEXTURE"+(k+5)])}else{c.setUniform("hasTexture"+(k+1),true);c.setTexture(o[k],glc["TEXTURE"+k])}else{c.setUniform("hasTextureCube"+(k+1),false);c.setUniform("hasTexture"+(k+1),false)}c.setUniform("sampler"+(k+1),k);c.setUniform("samplerCube"+(k+1),k+5)}},setState:function(c){this.setUniforms(c);this.setAttributes(c);this.setVertices(c);this.setColors(c);this.setPickingColors(c);this.setNormals(c);this.setTextures(c);this.setTexCoords(c);this.setIndices(c)},unsetState:function(c){var j=
c.attributes;c=c.gl;c.bindBuffer(c.ARRAY_BUFFER,null);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null);for(var k in j)c.disableVertexAttribArray(j[k])}});i.Cube=function(c){i.Model.call(this,t.extend({vertices:[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],texCoords:[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],normals:[0,
0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},c||{}))};i.Cube.prototype=Object.create(i.Model.prototype);i.Sphere=function(c){var j=c.nlat||10,k=c.nlong||10,o=c.radius||1,p=h-0,u=2*h-0,s=(j+1)*(k+1),a=new Float32Array(s*3),b=new Float32Array(s*3);s=new Float32Array(s*2);var f=new Uint16Array(j*
k*6);if(typeof o=="number"){var m=o;o=function(){return m}}for(var r=0;r<=j;r++)for(var q=0;q<=k;q++){var v=q/k,w=r/j,y=u*v,A=p*w,C=g(y);y=n(y);var D=g(A),B=n(A);A=y*D;y=B;C*=D;D=o(A,y,C,v,w);B=q+r*(k+1);var F=B*3;B*=2;a[F+0]=D*A;a[F+1]=D*y;a[F+2]=D*C;b[F+0]=A;b[F+1]=y;b[F+2]=C;s[B+0]=v;s[B+1]=w}o=j+1;for(q=0;q<j;q++)for(r=0;r<k;r++){B=(q*k+r)*6;f[B+0]=r*o+q;f[B+1]=r*o+q+1;f[B+2]=(r+1)*o+q;f[B+3]=(r+1)*o+q;f[B+4]=r*o+q+1;f[B+5]=(r+1)*o+q+1}i.Model.call(this,t.extend({vertices:a,indices:f,normals:b,
texCoords:s},c||{}))};i.Sphere.prototype=Object.create(i.Model.prototype);i.IcoSphere=function(c){var j=c.iterations||0,k=[],o=[],p=Math.sqrt,u=Math.acos,s=Math.atan2,a=Math.PI,b=a*2;c.onAddVertex=c.onAddVertex||t.empty;var f=(1+p(5))/2,m=p(1+f*f);k.push(-1/m,f/m,0,1/m,f/m,0,-1/m,-f/m,0,1/m,-f/m,0,0,-1/m,f/m,0,1/m,f/m,0,-1/m,-f/m,0,1/m,-f/m,f/m,0,-1/m,f/m,0,1/m,-f/m,0,-1/m,-f/m,0,1/m);o.push(0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,
4,11,6,2,10,8,6,7,9,8,1);var r=function(){var T={};return function(Q,R){Q*=3;R*=3;var L=(Q<R?Q:R)+"|"+(Q>R?Q:R);if(L in T)return T[L];var V=(k[Q]+k[R])/2,W=(k[Q+1]+k[R+1])/2,X=(k[Q+2]+k[R+2])/2,Y=p(V*V+W*W+X*X);V/=Y;W/=Y;X/=Y;k.push(V,W,X);return T[L]=k.length/3-1}}();for(f=0;f<j;f++){var q=[],v=0;for(m=o.length;v<m;v+=3){var w=r(o[v],o[v+1]),y=r(o[v+1],o[v+2]),A=r(o[v+2],o[v]);q.push(o[v],w,A,o[v+1],y,w,o[v+2],A,y,w,y,A)}o=q}m=o.length;j=new Float32Array(m*3);r=new Float32Array(m*2);for(f=0;f<m;f+=
3){y=o[f];A=o[f+1];var C=o[f+2];q=y*3;v=A*3;w=C*3;y*=2;A*=2;C*=2;var D=k[q],B=k[q+1],F=k[q+2],I=u(F/p(D*D+B*B+F*F)),J=s(B,D);I/=a;J=1-J/b;var G=k[v],E=k[v+1],H=k[v+2],K=u(H/p(G*G+E*E+H*H)),M=s(E,G);K/=a;M=1-M/b;var N=k[w],O=k[w+1],P=k[w+2],U=u(P/p(N*N+O*O+P*P)),S=s(O,N);U/=a;S=1-S/b;D=z.cross({x:N-G,y:O-E,z:P-H},{x:D-G,y:B-E,z:F-H}).$unit();j[q]=j[v]=j[w]=D.x;j[q+1]=j[v+1]=j[w+1]=D.y;j[q+2]=j[v+2]=j[w+2]=D.z;r[y]=J;r[y+1]=I;r[A]=M;r[A+1]=K;r[C]=S;r[C+1]=U}i.Model.call(this,t.extend({vertices:k,indices:o,
normals:j,texCoords:r},c||{}))};i.IcoSphere.prototype=Object.create(i.Model.prototype);i.TruncatedCone=function(c){var j=c.bottomRadius||0,k=c.topRadius||0,o=c.height||1,p=c.nradial||10,u=c.nvertical||10,s=!!c.topCap,a=!!c.bottomCap,b=(s?2:0)+(a?2:0),f=(p+1)*(u+1+b),m=new Float32Array(f*3),r=new Float32Array(f*3);f=new Float32Array(f*2);var q=new Uint16Array(p*(u+b)*6),v=p+1,w=Math,y=w.atan2(j-k,o),A=w.sin,C=w.cos;w=w.PI;var D=C(y);y=A(y);a=u+(a?2:0);var B=0,F=0;for(s=s?-2:0;s<=a;s++){var I=s/u,J=
o*I,G;if(s<0){J=0;I=1;G=j}else if(s>u){J=o;I=1;G=k}else G=j+(k-j)*(s/u);if(s==-2||s==u+2)I=G=0;J-=o/2;for(var E=0;E<v;E++){var H=A(E*w*2/p),K=C(E*w*2/p);m[B+0]=H*G;m[B+1]=J;m[B+2]=K*G;r[B+0]=s<0||s>u?0:H*D;r[B+1]=s<0?-1:s>u?1:y;r[B+2]=s<0||s>u?0:K*D;f[F+0]=E/p;f[F+1]=I;F+=2;B+=3}}for(s=0;s<u+b;s++)for(E=0;E<p;E++){j=(s*p+E)*6;q[j+0]=v*(s+0)+0+E;q[j+1]=v*(s+0)+1+E;q[j+2]=v*(s+1)+1+E;q[j+3]=v*(s+0)+0+E;q[j+4]=v*(s+1)+1+E;q[j+5]=v*(s+1)+0+E}i.Model.call(this,t.extend({vertices:m,normals:r,texCoords:f,
indices:q},c||{}))};i.TruncatedCone.prototype=Object.create(i.Model.prototype);i.Cone=function(c){c.topRadius=0;c.topCap=!!c.cap;c.bottomCap=!!c.cap;c.bottomRadius=c.radius||3;i.TruncatedCone.call(this,c)};i.Cone.prototype=Object.create(i.TruncatedCone.prototype);i.Cylinder=function(c){c.bottomRadius=c.radius;c.topRadius=c.radius;i.TruncatedCone.call(this,c)};i.Cylinder.prototype=Object.create(i.TruncatedCone.prototype);i.Plane=function(c){var j=c.type,k=j.split(","),o=c[k[0]+"len"],p=c[k[1]+"len"],
u=c["n"+k[0]]||1;k=c["n"+k[1]]||1;var s=c.offset,a=!!c.flipCull,b=(u+1)*(k+1),f=new Float32Array(b*3),m=new Float32Array(b*3);b=new Float32Array(b*2);var r=0,q=0;if(a)o=-o;for(var v=0;v<=k;v++)for(var w=0;w<=u;w++){var y=w/u,A=v/k;b[r+0]=a?1-y:y;b[r+1]=A;r+=2;switch(j){case "x,y":f[q+0]=o*y-o*0.5;f[q+1]=p*A-p*0.5;f[q+2]=s;m[q+0]=0;m[q+1]=0;m[q+2]=a?1:-1;break;case "x,z":f[q+0]=o*y-o*0.5;f[q+1]=s;f[q+2]=p*A-p*0.5;m[q+0]=0;m[q+1]=a?1:-1;m[q+2]=0;break;case "y,z":f[q+0]=s;f[q+1]=o*y-o*0.5;f[q+2]=p*A-
p*0.5;m[q+0]=a?1:-1;m[q+1]=0;m[q+2]=0}q+=3}j=u+1;o=[];for(v=0;v<k;v++)for(w=0;w<u;w++){p=(v*u+w)*6;o[p+0]=(v+0)*j+w;o[p+1]=(v+1)*j+w;o[p+2]=(v+0)*j+w+1;o[p+3]=(v+1)*j+w;o[p+4]=(v+1)*j+w+1;o[p+5]=(v+0)*j+w+1}i.Model.call(this,t.extend({vertices:f,normals:m,texCoords:b,indices:o},c))};i.Plane.prototype=Object.create(i.Model.prototype);i.id=t.time();PhiloGL.O3D=i})();(function(){var x={Vertex:{},Fragment:{}},t=x.Fragment;x.Vertex.Default="#define LIGHT_MAX 4\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color;\nattribute vec4 pickingColor;\nattribute vec2 texCoord1;\nuniform mat4 viewMatrix;\nuniform mat4 viewInverseMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewProjectionMatrix;\nuniform mat4 worldMatrix;\nuniform mat4 worldInverseMatrix;\nuniform mat4 worldInverseTransposeMatrix;\nuniform mat4 objectMatrix;\nuniform vec3 cameraPosition;\nuniform bool enableLights;\nuniform vec3 ambientColor;\nuniform vec3 directionalColor;\nuniform vec3 lightingDirection;\nuniform vec3 pointLocation[LIGHT_MAX];\nuniform vec3 pointColor[LIGHT_MAX];\nuniform int numberPoints;\nuniform bool useReflection;\nvarying vec3 vReflection;\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec4 vNormal;\nvarying vec3 lightWeighting;\nvoid main(void) {\nvec4 mvPosition = worldMatrix * vec4(position, 1.0);\nvec4 transformedNormal = worldInverseTransposeMatrix * vec4(normal, 1.0);\nif(!enableLights) {\nlightWeighting = vec3(1.0, 1.0, 1.0);\n} else {\nvec3 plightDirection;\nvec3 pointWeight = vec3(0.0, 0.0, 0.0);\nfloat directionalLightWeighting = max(dot(transformedNormal.xyz, lightingDirection), 0.0);\nfor (int i = 0; i < LIGHT_MAX; i++) {\nif (i < numberPoints) {\nplightDirection = normalize((viewMatrix * vec4(pointLocation[i], 1.0)).xyz - mvPosition.xyz);\npointWeight += max(dot(transformedNormal.xyz, plightDirection), 0.0) * pointColor[i];\n} else {\nbreak;\n}\n}\nlightWeighting = ambientColor + (directionalColor * directionalLightWeighting) + pointWeight;\n}\nif (useReflection) {\nvReflection = (viewInverseMatrix[3] - (worldMatrix * vec4(position, 1.0))).xyz;\n} else {\nvReflection = vec3(1.0, 1.0, 1.0);\n}\nvColor = color;\nvPickingColor = pickingColor;\nvTexCoord = texCoord1;\nvNormal = transformedNormal;\ngl_Position = projectionMatrix * worldMatrix * vec4(position, 1.0);\n}";
t.Default="#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 vColor;\nvarying vec4 vPickingColor;\nvarying vec2 vTexCoord;\nvarying vec3 lightWeighting;\nvarying vec3 vReflection;\nvarying vec4 vNormal;\nuniform bool hasTexture1;\nuniform sampler2D sampler1;\nuniform bool hasTextureCube1;\nuniform samplerCube samplerCube1;\nuniform bool enablePicking;\nuniform bool hasPickingColors;\nuniform vec3 pickColor;\nuniform float reflection;\nuniform float refraction;\nuniform bool hasFog;\nuniform vec3 fogColor;\nuniform float fogNear;\nuniform float fogFar;\nvoid main(){\nif (!hasTexture1) {\ngl_FragColor = vec4(vColor.rgb * lightWeighting, vColor.a);\n} else {\ngl_FragColor = vec4(texture2D(sampler1, vec2(vTexCoord.s, vTexCoord.t)).rgb * lightWeighting, 1.0);\n}\nif (hasTextureCube1) {\nvec3 nReflection = normalize(vReflection);\nvec3 reflectionValue;\nif (refraction > 0.0) {\nreflectionValue = refract(nReflection, vNormal.xyz, refraction);\n} else {\nreflectionValue = -reflect(nReflection, vNormal.xyz);\n}\nvec4 cubeColor = textureCube(samplerCube1, vec3(-reflectionValue.x, -reflectionValue.y, reflectionValue.z));\ngl_FragColor = vec4(mix(gl_FragColor.xyz, cubeColor.xyz, reflection), 1.0);\n}\nif (enablePicking) {\nif (hasPickingColors) {\ngl_FragColor = vPickingColor;\n} else {\ngl_FragColor = vec4(pickColor, 1.0);\n}\n}\nif (hasFog) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = smoothstep(fogNear, fogFar, depth);\ngl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);\n}\n}";
PhiloGL.Shaders=x})();(function(){var x=PhiloGL.Vec3,t=PhiloGL.$,z=function(l,n,g){g=t.merge({lights:{enable:false,ambient:{r:0.2,g:0.2,b:0.2},directional:{direction:{x:1,y:1,z:1},color:{r:0,g:0,b:0}}},effects:{fog:false}},g||{});this.program=g.program?l[g.program]:l;this.app=this.program.app;this.camera=n;this.models=[];this.config=g};z.prototype={add:function(){for(var l=0,n=this.models,g=arguments.length;l<g;l++){var h=arguments[l];h.id=h.id||t.uid();n.push(h);this.defineBuffers(h)}},remove:function(l){var n=
this.models;l=n.indexOf(l);l>-1&&n.splice(l,1)},getProgram:function(l){var n=this.program;if(n.$$family!="program"&&l&&l.program){n=n[l.program];n.use()}return n},defineBuffers:function(l){var n=this.getProgram(l),g=l.dynamic;l.dynamic=true;l.setState(n);l.dynamic=g;l.unsetState(n)},beforeRender:function(l){this.setupLighting(l);this.setupEffects(l);this.camera&&this.camera.setStatus(l)},setupLighting:function(l){var n=this.config.lights,g=n.ambient,h=n.directional,d=h.color,i=h.direction,c=n.enable;
n=n.points&&t.splat(n.points)||[];h=n.length;var j=[],k=[],o=[],p=[];i=(new x(i.x,i.y,i.z)).$unit().$scale(-1);l.setUniform("enableLights",c);if(c){l.setUniform("ambientColor",[g.r,g.g,g.b]);l.setUniform("directionalColor",[d.r,d.g,d.b]);l.setUniform("lightingDirection",[i.x,i.y,i.z]);l.setUniform("numberPoints",h);for(g=0;g<h;g++){c=n[g];d=c.position;i=c.color||c.diffuse;c=c.specular;j.push(d.x,d.y,d.z);k.push(i.r,i.g,i.b);o.push(+!!c);c?p.push(c.r,c.g,c.b):p.push(0,0,0)}l.setUniforms({pointLocation:j,
pointColor:k});l.setUniforms({enableSpecular:o,pointSpecularColor:p})}},setupEffects:function(l){var n=this.config.effects.fog,g=n.color||{r:0.5,g:0.5,b:0.5};n?l.setUniforms({hasFog:true,fogNear:n.near,fogFar:n.far,fogColor:[g.r,g.g,g.b]}):l.setUniform("hasFog",false)},render:function(l){l=l||{};var n=this.camera,g=this.program,h=l.renderProgram,d=t.type(g);d=!h&&d=="object";l=t.extend({onBeforeRender:t.empty,onAfterRender:t.empty},l||{});!d&&this.beforeRender(h||g);for(var i=0,c=this.models,j=c.length;i<
j;++i){var k=c[i];if(k.display){g=h||this.getProgram(k);d&&this.beforeRender(g);k.onBeforeRender(g,n);l.onBeforeRender(k,i);this.renderObject(k,g);l.onAfterRender(k,i);k.onAfterRender(g,n)}}},renderToTexture:function(l,n){var g=this.app,h=g.gl;n=n||{};var d=g.textures[l+"-texture"];g=g.textureMemo[l+"-texture"];this.render(n);h.bindTexture(g.textureType,d)},renderObject:function(l,n){var g=this.camera,h=l.matrix,d=g.view.mulMat4(h),i=d.invert(),c=i.transpose();app=n.app;gl=app.gl;l.setState(n);n.setUniforms({objectMatrix:h,
worldMatrix:d,worldInverseMatrix:i,worldInverseTransposeMatrix:c});if(l.render)l.render(gl,n,g);else l.$indicesLength?gl.drawElements(l.drawType!==undefined?gl.get(l.drawType):gl.TRIANGLES,l.$indicesLength,gl.UNSIGNED_SHORT,0):gl.drawArrays(l.drawType!==undefined?gl.get(l.drawType):gl.TRIANGLES,0,l.$verticesLength/3);l.unsetState(n)},setupPicking:function(){var l=this.app,n=PhiloGL.Program.fromDefaultShaders({app:l,gl:l.gl});l.setFrameBuffer("$picking",{width:5,height:1,bindToTexture:{parameters:[{name:"TEXTURE_ MAG_FILTER",
value:"LINEAR"},{name:"TEXTURE_MIN_FILTER",value:"LINEAR",generateMipmap:false}]},bindToRenderBuffer:true});l.setFrameBuffer("$picking",false);this.pickingProgram=n},pick:function(l,n){this.pickingProgram||this.setupPicking();var g={},h=[],d=app.usedProgram,i=this.pickingProgram,c=this.camera,j=c.target,k=c.aspect,o=this.config,p=o.lights.enable,u=o.effects.fog,s=gl.canvas.width,a=gl.canvas.height,b=this.unproject([l*2/s-1,1-n*2/a,1],c),f=new Uint8Array(4);this.camera.target=b;this.camera.update();
o.lights.enable=false;o.effects.fog=false;app.setFrameBuffer("$picking",true);i.use();i.setUniform("enablePicking",true);gl.disable(gl.BLEND);gl.viewport(0,0,5,1);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);gl.readPixels(0,0,1,1,gl.RGBA,gl.UNSIGNED_BYTE,f);this.renderPickingScene({background:f[0]+f[1]*256+f[2]*65536,o3dHash:g,o3dList:h,hash:[]});gl.readPixels(2,0,1,1,gl.RGBA,gl.UNSIGNED_BYTE,f);b=[f[0],f[1],f[2]].join();b=g[b];var m;if(!b)for(var r=0,q=h.length;r<q;r++){b=h[r];m=b.pick(f);if(m!==
false)b.$pickingIndex=m;else b=false}app.setFrameBuffer("$picking",false);app.setTexture("$picking-texture",false);i.setUniform("enablePicking",false);o.lights.enable=p;o.effects.fog=u;d&&d.use();gl.viewport(0,0,s,a);c.target=j;c.aspect=k;c.update();this.o3dHash=g;this.o3dList=h;this.pixel=f;this.capture=void 0;return b&&b.pickable&&b},unproject:function(l,n){return n.view.invert().mulMat4(n.projection.invert()).mulVec3(l)},renderPickingScene:function(l){if(this.config.renderPickingScene)this.config.renderPickingScene.call(this,
l);else{var n=this.pickingProgram,g=l.o3dHash,h=l.o3dList,d=l.background,i=l.hash,c=0;this.renderToTexture("$picking",{renderProgram:n,onBeforeRender:function(j,k){if(k==d)c=1;var o=k+c,p=!!j.pickingColors;n.setUniform("hasPickingColors",p);if(p)h.push(j);else{i[0]=o%256;i[1]=(o/256>>0)%256;i[2]=(o/65536>>0)%256;n.setUniform("pickColor",[i[0]/255,i[1]/255,i[2]/255]);g[i.join()]=j}}})}},resetPicking:t.empty};z.MAX_TEXTURES=10;z.MAX_POINT_LIGHTS=4;z.PICKING_RES=4;PhiloGL.Scene=z})();(function(){function x(t,
z){for(var l=this.workers=[];z--;)l.push(new Worker(t))}x.prototype={map:function(t){var z=this.workers,l=this.configs=[],n=0;for(z=z.length;n<z;n++)l.push(t&&t(n));return this},reduce:function(t){for(var z=t.reduceFn,l=this.workers,n=this.configs,g=l.length,h=t.initialValue,d=function(k){g--;h=h===undefined?k.data:z(h,k.data);if(g==0)t.onComplete(h)},i=0,c=g;i<c;i++){var j=l[i];j.onmessage=d;j.postMessage(n[i])}return this}};PhiloGL.WorkerGroup=x})();(function(){var x=PhiloGL.$,t=function(d){this.opt=
x.merge({delay:0,duration:1E3,transition:function(i){return i},onCompute:x.empty,onComplete:x.empty},d||{})},z=t.Queue=[];t.prototype={time:null,start:function(d){this.opt=x.merge(this.opt,d||{});this.time=x.time();this.animating=true;z.push(this)},step:function(){if(this.animating){var d=x.time(),i=this.time,c=this.opt,j=c.delay,k=c.duration,o=0;if(d<i+j)c.onCompute.call(this,o);else if(d<i+j+k){o=c.transition((d-i-j)/k);c.onCompute.call(this,o)}else{this.animating=false;c.onCompute.call(this,1);
c.onComplete.call(this)}}}};t.compute=function(d,i,c){return d+(i-d)*c};t.Transition={linear:function(d){return d}};var l=t.Transition;(function(){var d=function(j,k){k=x.splat(k);return x.extend(j,{easeIn:function(o){return j(o,k)},easeOut:function(o){return 1-j(1-o,k)},easeInOut:function(o){return o<=0.5?j(2*o,k)/2:(2-j(2*(1-o),k))/2}})},i={Pow:function(j,k){return Math.pow(j,k[0]||6)},Expo:function(j){return Math.pow(2,8*(j-1))},Circ:function(j){return 1-Math.sin(Math.acos(j))},Sine:function(j){return 1-
Math.sin((1-j)*Math.PI/2)},Back:function(j,k){k=k[0]||1.618;return Math.pow(j,2)*((k+1)*j-k)},Bounce:function(j){for(var k,o=0,p=1;;o+=p,p/=2)if(j>=(7-4*o)/11){k=p*p-Math.pow((11-6*o-11*j)/4,2);break}return k},Elastic:function(j,k){return Math.pow(2,10*--j)*Math.cos(20*j*Math.PI*(k[0]||1)/3)}},c;for(c in i)l[c]=d(i[c]);["Quad","Cubic","Quart","Quint"].forEach(function(j,k){l[j]=d(function(o){return Math.pow(o,[k+2])})})})();var n=self||window,g=function(){var d=[];if(z.length){for(var i=0,c=z.length,
j;i<c;i++){j=z[i];j.step();j.animating&&d.push(j)}t.Queue=z=d}};if(n){var h=false;["webkitAnimationTime","mozAnimationTime","animationTime","webkitAnimationStartTime","mozAnimationStartTime","animationStartTime"].forEach(function(d){if(d in n){t.animationTime=function(){return n[d]};h=true}});if(!h)t.animationTime=x.time;h=false;["webkitRequestAnimationFrame","mozRequestAnimationFrame","requestAnimationFrame"].forEach(function(d){if(d in n){t.requestAnimationFrame=function(i){n[d](function(){g();
i()})};h=true}});if(!h)t.requestAnimationFrame=function(d){setTimeout(function(){g();d()},1E3/60)}}PhiloGL.Fx=t})();(function(){var x=PhiloGL.$,t={},z=function(){};z.postProcess=function(){var l=new PhiloGL.O3D.Plane({type:"x,y",xlen:1,ylen:1,offset:0}),n=new PhiloGL.Camera(45,1,0.1,500,{position:{x:0,y:0,z:1.205}}),g=new PhiloGL.Scene({},n);return function(h,d){var i=d.gl,c=d.program.$$family?d.program:d.program[h.program],j=h.fromTexture?x.splat(h.fromTexture):[],k=h.toFrameBuffer,o=!!h.toScreen,
p=h.width||d.canvas.width,u=h.height||d.canvas.height;n.aspect=h.aspectRatio?h.aspectRatio:Math.max(u/p,p/u);n.update();g.program=c;l.textures=j;l.program=c;g.models.length||g.add(l);if(k){k in d.frameBufferMemo||d.setFrameBuffer(k,{width:p,height:u,bindToTexture:{parameters:[{name:"TEXTURE_MAG_FILTER",value:"LINEAR"},{name:"TEXTURE_MIN_FILTER",value:"LINEAR",generateMipmap:false}]},bindToRenderBuffer:false});c.use();d.setFrameBuffer(k,true);i.viewport(0,0,p,u);i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT);
c.setUniforms(h.uniforms||{});g.renderToTexture(k);d.setFrameBuffer(k,false)}if(o){c.use();i.viewport(0,0,p,u);i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT);c.setUniforms(h.uniforms||{});g.render()}return this}}();t.Image=z;PhiloGL.Media=t})()})();
